<!DOCTYPE html>
<html>
<head>
	<title>Menupoly</title>
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
	<link href="https://fonts.googleapis.com/css?family=Sedgwick+Ave+Display" rel="stylesheet">

	<!-- Pre requisites for Google Sign In -->
	<meta name="google-signin-client_id" content="6593651812-g6n1kkdkvnet3e1v3f10jnbleqkq6137.apps.googleusercontent.com">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js">
  	</script>
	<script src="//apis.google.com/js/platform.js" async defer>
	</script>
</head>
<body>
	<!-- Sign in Buttons -->
	<div id="signInButtons">
		<span class="g-signin2"
			data-scope="https://www.googleapis.com/auth/plus.login"
			data-clientid="6593651812-g6n1kkdkvnet3e1v3f10jnbleqkq6137.apps.googleusercontent.com"
			data-redirecturi="postmessage"
			data-accesstype="offline"
			data-cookiepolicy="single_host_origin"
			data-onsuccess="onSignIn"
			data-onfailure="onSignInFailure">
		</span>
	</div>
	<div id="result">
	</div>
	<script>
		function onSignIn(googleUser) {
			console.log('Sign in successful.')
			$('#signInButtons').attr('style', 'display: none');

			$.ajax({
				type: 'POST',
				url: '/gconnect?state={{STATE}}',
				processData: false,
				contentType: 'application/octet-stream; charset=utf-8',
				data: googleUser.getAuthResponse().id_token,
				success: function(result) {
					if (result) {
						$('#result').html('Login Successful!</br>' + result + '</br>Redirecting...');
						setTimeout(function() {
							window.location.href = "/restaurants";
						}, 4000);
					} else {
						$('#result').html('Error processing login. </br>' + result);
					}
				}
			})
		}

		function onSignInFailure() {
			$('#result').html('Sign in failed -- please try again.');
		}

//		function signInCallback(authResult) {
//			if (authResult['code']) {
//				$('#signInButtons').attr('style', 'display: none');
//
//				$.ajax({
//					type: 'POST',
//					url: '/gconnect?state={{STATE}}',
//					processData: false,
//					contentType: 'application/octet-stream; charset=utf-8',
//					data: authResult['code'],
//					success: function(result) {
//						if (result) {
//							$('#result').html('Login Successful!</br>' + result + '</br>Redirecting...')
//							setTimeout(function() {
//								window.location.href = "/restaurants";
//							}, 4000);
//						} else if (authResult['error']) {
//							console.log('There was an error: ' + authResult['error']);
//						} else {
//							$('#result').html('Failed to make a server-side call. Check your configuration and console.');
//						}
//					}
//				})
//			}
//		}
	</script>
</body>
</html>